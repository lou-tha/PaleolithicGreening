# File:    main.R
# Author:  Florian Linsel, Louise Tharandt
#############################################
#libraries
library(tidyverse)
library(dplyr)
library(purrr)
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
source("../VegPer_R_Scripts/Calc21Day.R")
source("../VegPer_R_Scripts/CalcStepsStandardised.R")
source("../VegPer_R_Scripts/CalcFilter.R")
source("../VegPer_R_Scripts/plot_2x2.R")
#############################################
# set workspace
setwd("../../") #reference inside of the github/workspace folder
getwd()
setwd("Vegetation_Period_edited2022/")
getwd()
# File:    21Days_VegPer_NGRIP
# Author:  Florian Linsel, Louise Tharandt
#############################################
#libraries
library(tidyverse)
library(dplyr)
library(purrr)
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
source("../finalising/CalcStep.R")
source("../finalising/CalcFilter.R")
source("../finalising/CalcOverview.R")
source("../finalising/Calc21Day.R")
source("../finalising/plot_2x2.R")
#############################################
# set workspace
setwd("../../") #reference inside of our github folder
# global parameter:
parameter <- c("LGM", "NGRIP", "BlackSea" )# "LGM" , "BlackSea" ,  #name of the datasets
# create new directories
for (p in parameter){
dir.create(file.path(paste0('VegPer_Results/')), showWarnings = FALSE)
dir.create(file.path(paste0('VegPer_Results/Calc_Step_Results/Calc_Step_',p)), showWarnings = FALSE)
dir.create(file.path(paste0('VegPer_Results/21Day_',p,'_Results')), showWarnings = FALSE)
dir.create(file.path(paste0('VegPer_Results/Filter_Results')), showWarnings = FALSE)
dir.create(file.path(paste0('VegPer_Results/Filter_Results/Filter_Results_',p)), showWarnings = FALSE)
dir.create(file.path(paste0('VegPer_Results/Filter_Results/Filter_Results_',p,'/nodes')), showWarnings = FALSE)
}
# input files
# LGM data and factors, that will be added to get the temperature data of stadial and interstadial periods
LGM <- read.csv("VegPer_Base_Data/LGM_base_data.csv", header = T,  fileEncoding="UTF-8-BOM")
# list of stadial and interstadial periods
period <- c("GS-3", "GI-3", "GS-4", "GI-4", "GS-5.1", "GI-5.1", "GS-5.2", "GI-5.2",
"GS-6", "GI-6", "GS-7", "GI-7", "GS-8", "GI-8", "GS-9", "GI-9") # climatic periods of interst
##############################################
# Calc21Day
# list of months
month <- c(1:12)
lapply(parameter,DAY_21,period,month) # calculating the 21 day average
##############################################
# CalcStep
step_day_size <- c(2,7,14,21,28) # former step day size: seq(from = 2, to = 7, 1)
# set workspace
setwd("VegPer_Results/")
#QGIS_ID (lat,long)
lapply (parameter,stepfunction,period,step_day_size)
##############################################
# CalcFilter
df_result_result <- data.frame()
lapply (parameter,VegPer_Results,df_result_result)
##############################################
# CalcOverview
lapply (parameter,filter)
##############################################
# plot_2x2
period_concat <- list(list("GS-3", "GI-3"),list("GS-4", "GI-4"), list("GS-5.1", "GI-5.1"),list("GS-5.2", "GI-5.2"),
list("GS-6", "GI-6"),list("GS-7", "GI-7"), list("GS-8", "GI-8"),    list("GS-9", "GI-9")) # climatic periods of interest
setwd("extdata")
lapply (parameter,plot_2x2,period_concat)
############################################################################################
# create the plots in PYthon and QGIS
# ....
library(reticulate)
use_python("C:/Program Files/QGIS 3.10/apps/Python37")
#C:\Program Files\GDAL
Sys.setenv(RETICULATE_PYTHON = "C:/Program Files/QGIS 3.10/apps/Python37")
getwd()
setwd("VegPer_QGIS/")
reticulate::py_discover_config(required_module = "gdal")
source_python("Froot_Loops_QGIS_3.py")
